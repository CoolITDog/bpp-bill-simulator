# BPP流程异常智能分析平台 PRD

## 1. 产品概述

### 1.1 产品背景
BPP流程引擎平台在正常使用过程中经常出现用户流程数据异常问题，维护人员每次都需要拿到用户数据，本地启动代码调试才能定位问题。这种方式效率低下，影响问题解决速度和用户体验。

### 1.2 产品目标
搭建一个智能化平台，支持获取Git仓库地址和用户表单异常数据，通过规则引擎和大模型分析得出可能存在的问题原因，从而提高问题定位效率，减少维护人员工作量。

### 1.3 产品定位
- 面向**平台维护者**的工具，而非业务方
- 核心目标：将"人工本地调试"的核心步骤自动化，输出「高置信度的异常原因+排查建议」
- 边界：不替代最终决策，但能80%覆盖常见异常场景，减少80%的本地调试时间

## 2. 功能需求

### 2.1 核心功能

| 功能模块 | 功能描述 | 优先级 |
|---------|---------|--------|
| Git仓库配置 | 支持添加、删除Git仓库信息，用于后续代码分析 | 高 |
| 异常数据收集 | 支持提交表单异常数据，生成标准化结构化JSON | 高 |
| 智能分析引擎 | 结合代码逻辑+异常数据，定位根因（规则引擎+大模型双驱动） | 中高 |
| 分析结果展示 | 输出问题原因、代码位置、修复建议 | 中 |
| 历史案例沉淀 | 积累异常场景-根因映射，提升分析准确率 | 中低 |

### 2.2 详细功能

#### 2.2.1 Git仓库配置
- 支持添加Git仓库信息（名称、URL、分支、核心目录）
- 支持删除Git仓库
- 支持查看已配置的Git仓库列表

#### 2.2.2 异常数据收集
- 支持填写流程实例ID、异常节点、异常字段等信息
- 支持上传表单数据JSON文件
- 支持选择异常场景
- 生成标准化的结构化异常数据JSON

#### 2.2.3 智能分析引擎
- 规则引擎：基于预设规则匹配异常场景
- 大模型分析：处理规则未覆盖的长尾场景
- 结果置信度评估
- 代码位置定位

#### 2.2.4 分析结果展示
- 异常概览（流程实例ID、异常节点、异常字段）
- 根因分析（规则引擎/大模型结果，标注置信度）
- 代码定位（链接到Git仓库的对应文件+行号）
- 修复建议（分步操作）
- 历史案例（相似异常的处理方案）

#### 2.2.5 历史案例沉淀
- 自动记录分析结果
- 支持按异常场景、根因等维度查询
- 支持手动标记分析结果准确性

## 3. 非功能需求

| 需求类型 | 需求描述 | 优先级 |
|---------|---------|--------|
| 性能 | 分析时间不超过10秒 | 中 |
| 可靠性 | 系统可用性达到99% | 中 |
| 安全性 | Git仓库访问权限控制 | 高 |
| 易用性 | 界面简洁直观，操作步骤不超过3步 | 中高 |
| 可扩展性 | 支持规则库动态更新，支持接入不同大模型 | 中 |

## 4. 数据需求

### 4.1 结构化异常数据
```json
{
  "processInstanceId": "PROC-20251212-0001",
  "exceptionNode": "approve-node-01",
  "exceptionField": "travel_days",
  "exceptionDesc": "填写3天，审批节点显示1天",
  "submitData": {"travel_days": 3, "amount": 1000},
  "nodeConfig": {"mapping": {"travel_days": "days"}},
  "operateTime": "2025-12-12 10:00",
  "gitRepo": "repo1",
  "exceptionScene": "field_value_error"
}
```

### 4.2 规则库数据结构
```json
{
  "id": "rule1",
  "scene": "field_value_error",
  "name": "字段值在节点流转后数值错误",
  "condition": ["异常字段的映射关系中，目标字段名与源字段名不一致"],
  "rootCause": "数据映射时字段名配置错误",
  "codeCheckPoint": "src/flow/mapping.js:58",
  "suggestion": "核对异常节点的字段映射配置",
  "confidence": 0.95
}
```

### 4.3 分析结果数据结构
```json
{
  "id": "result1",
  "timestamp": "2025-12-12T10:00:00Z",
  "inputData": {...}, // 结构化异常数据
  "analysis": {
    "severity": "high",
    "potentialIssues": [
      {
        "id": "issue1",
        "type": "数据格式错误",
        "message": "表单数据中缺少必填字段：processInstanceId",
        "confidence": 0.95,
        "location": "src/flow/mapping.js:58",
        "suggestion": "检查表单提交逻辑"
      }
    ],
    "summary": "分析发现1个潜在问题..."
  }
}
```

## 5. 界面设计

### 5.1 整体布局
- 左侧导航栏：仪表盘、Git仓库配置、异常数据分析、分析结果、系统设置
- 右侧内容区：对应功能模块的详细内容

### 5.2 页面设计

#### 5.2.1 仪表盘
- 显示应用概览和快速开始指南
- 统计待分析异常、已分析案例、配置的Git仓库数量

#### 5.2.2 Git仓库配置
- 表单：添加Git仓库信息
- 表格：展示已配置的Git仓库列表

#### 5.2.3 异常数据分析
- 表单：填写异常数据
- 预览：生成的标准化JSON数据
- 按钮：开始分析

#### 5.2.4 分析结果
- 异常概览卡片
- 分析摘要
- 潜在问题列表
- 原始数据预览

## 6. 实施计划

### 6.1 阶段1：MVP版（1-2周）
- 完成Git仓库配置功能
- 完成异常数据收集功能
- 实现规则引擎，覆盖8个常见异常场景
- 完成分析结果展示功能

### 6.2 阶段2：智能化升级（2-4周）
- 接入大模型API
- 完善代码解析逻辑，支持AST提取
- 实现历史案例沉淀功能

### 6.3 阶段3：优化迭代（长期）
- 优化规则库和大模型分析算法
- 支持更多异常场景
- 实现企业微信/钉钉通知

## 7. 风险评估

| 风险类型 | 风险描述 | 应对措施 |
|---------|---------|--------|
| 技术风险 | 大模型输出不准确 | 规则引擎覆盖高频场景，大模型结果标注置信度 |
| 数据风险 | Git仓库访问安全 | 严格的权限控制，只读访问 |
| 性能风险 | 分析时间过长 | 优化代码解析和分析算法 |
| 依赖风险 | 外部大模型API不可用 | 支持多模型切换，本地规则引擎兜底 |

## 8. 验收标准

| 功能模块 | 验收标准 |
|---------|---------|
| Git仓库配置 | 能成功添加、删除仓库，能查看仓库列表 |
| 异常数据收集 | 能生成标准化JSON，支持文件上传 |
| 智能分析引擎 | 能输出分析结果，准确率达到80% |
| 分析结果展示 | 结果清晰直观，包含问题原因、代码位置、修复建议 |
| 历史案例沉淀 | 能记录和查询历史案例 |

## 9. 后续规划

- 支持更多异常场景的自动分析
- 实现与BPP流程引擎平台的集成
- 支持实时监控和预警
- 提供API接口，支持第三方系统调用

# 附录

## 术语表

| 术语 | 解释 |
|------|------|
| BPP | Business Process Platform，业务流程平台 |
| 流程实例ID | 每个流程运行实例的唯一标识符 |
| 异常节点 | 流程中出现异常的节点 |
| 异常字段 | 流程数据中出现异常的字段 |
| 规则引擎 | 基于预设规则进行匹配的引擎 |
| AST | Abstract Syntax Tree，抽象语法树，用于代码解析 |
| RAG | Retrieval-Augmented Generation，检索增强生成，用于大模型分析 |